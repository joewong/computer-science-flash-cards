{% extends "layout.html" %}
{% block body %}

    <script>
        var items = []
    </script>
    <div id="card-questions" class="col-xs-8 col-xs-offset-2 carousel" data-interval="false" data-ride="false">
        <div class="carousel-inner" role="listbox">
        {% set count = namespace(value=1) %}
        {% for card in cards %}
            <div class="item {% if count.value == 1 %}active{% endif %}">
                <div class="panel panel-default cardFront">
                    <div class="panel-body">
                        <div class="alignContainer">
                            <div class="alignMiddle frontText">
                                <h2 class="frontText">{{ card.front }}</h2> <br />
                                <ul id="items-{{ card.card_id }}">
                                    {% for question in questions[card.card_id] %}
                                        <li style="list-style: none; border: 1px solid blue; margin: 3px; padding: 3px;" id="{{ question['id'] }}">{{ question['item'] }}</li>
                                    {% endfor %}
                                </ul> 
                                <script>
                                    $("#items-{{ card.card_id }}").sortable();
                                    items.push("{{ card.card_id }}");
                                </script>
                            </div>
                        </div>
                    </div>
                </div> 
                <div>
                    {% if count.value > 1 %}
                    <a class="btn btn-primary btn-lg" href="#card-questions" role="button" data-slide="prev"><i class="fa fa-arrow-left"></i> previous</a>
                    {% else %}
                    <a class="btn btn-primary btn-lg disabled" href="#" role="button" aria-disabled="true"><i class="fa fa-arrow-left"></i> previous</a>
                    {% endif %}
                    {% if total_questions > count.value %}
                    <a class="btn btn-primary btn-lg" href="#card-questions" role="button" data-slide="next">next <i class="fa fa-arrow-right"></i></a>
                    {% else %}
                    <a class="btn btn-primary btn-lg disabled" href="#" aria-disabled="true" role="button" data-slide="next">next <i class="fa fa-arrow-right"></i></a>
                    {% endif %}
                    {% if count.value == total_questions %}
                    <a href="javascript:submitResults();" class="btn btn-primary btn-lg">submit</a>
                    {% else %}
                    <a href="#" class="btn btn-primary btn-lg disabled" aria-disabled="true">submit</a>
                    {% endif %}
                </div>
                {% set count.value = count.value + 1 %} 
            </div>
                            
        {% else %}
            <div>NO CARDS</div>
        {% endfor %}

        </div>
    </div>
    <script>
        function submitResults() {
            dataItems = {};
            for (var i in items) {
                dataItems[items[i]] = $('#items-'+items[i]).sortable('toArray');
            }            
            $.ajax('/submit/ordered/test/{{ test_id }}', {
                type: 'POST',
                data: {items: dataItems},
                success: function(data, textStatus) {
                    window.location.replace("/");
                }
            }); 
        }
    </script>
{% endblock %}
